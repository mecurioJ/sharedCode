<Query Kind="Program">
  <Connection>
    <ID>2e945996-a0e3-45cf-bf5c-fcb323818428</ID>
    <Persist>true</Persist>
    <Server>sqlsass</Server>
    <SqlSecurity>true</SqlSecurity>
    <UserName>mjfilichia</UserName>
    <Password>AQAAANCMnd8BFdERjHoAwE/Cl+sBAAAAEvzdJpREcE2SHJAaAsA5LAAAAAACAAAAAAAQZgAAAAEAACAAAACVWTL+nI9l33p3eZu1olArD7eUZms78xew/kDsXHrGdgAAAAAOgAAAAAIAACAAAABgQH13K/Rql0kaSuvNkoHH1ty7LiXpvelClBhSBm6gRhAAAACZELVvLAOsB7PradG9Dip3QAAAABrdMaSbdVkTcC5GY2xobPZRW8m5NmvxBh1py3i/eyg3iWtl56feCembfvaLx3m+E1pMPw+ahR9OuYxoa90BXPs=</Password>
    <Database>ECSDM_Staging</Database>
    <ShowServer>true</ShowServer>
  </Connection>
  <Reference>&lt;RuntimeDirectory&gt;\WPF\WindowsBase.dll</Reference>
  <NuGetReference>TopSoft.ExcelExport</NuGetReference>
  <Namespace>DocumentFormat.OpenXml</Namespace>
  <Namespace>DocumentFormat.OpenXml.AdditionalCharacteristics</Namespace>
  <Namespace>DocumentFormat.OpenXml.Bibliography</Namespace>
  <Namespace>DocumentFormat.OpenXml.CustomProperties</Namespace>
  <Namespace>DocumentFormat.OpenXml.CustomXmlDataProperties</Namespace>
  <Namespace>DocumentFormat.OpenXml.CustomXmlSchemaReferences</Namespace>
  <Namespace>DocumentFormat.OpenXml.Drawing</Namespace>
  <Namespace>DocumentFormat.OpenXml.Drawing.ChartDrawing</Namespace>
  <Namespace>DocumentFormat.OpenXml.Drawing.Charts</Namespace>
  <Namespace>DocumentFormat.OpenXml.Drawing.Diagrams</Namespace>
  <Namespace>DocumentFormat.OpenXml.Drawing.LegacyCompatibility</Namespace>
  <Namespace>DocumentFormat.OpenXml.Drawing.LockedCanvas</Namespace>
  <Namespace>DocumentFormat.OpenXml.Drawing.Pictures</Namespace>
  <Namespace>DocumentFormat.OpenXml.Drawing.Spreadsheet</Namespace>
  <Namespace>DocumentFormat.OpenXml.Drawing.Wordprocessing</Namespace>
  <Namespace>DocumentFormat.OpenXml.EMMA</Namespace>
  <Namespace>DocumentFormat.OpenXml.ExtendedProperties</Namespace>
  <Namespace>DocumentFormat.OpenXml.InkML</Namespace>
  <Namespace>DocumentFormat.OpenXml.Math</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office.ActiveX</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office.ContentType</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office.CoverPageProps</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office.CustomDocumentInformationPanel</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office.CustomUI</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office.CustomXsn</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office.Drawing</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office.Excel</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office.LongProperties</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office.MetaAttributes</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office.Word</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2010.CustomUI</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2010.Drawing</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2010.Drawing.ChartDrawing</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2010.Drawing.Charts</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2010.Drawing.Diagram</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2010.Drawing.LegacyCompatibility</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2010.Drawing.Pictures</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2010.Drawing.Slicer</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2010.Excel</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2010.Excel.Drawing</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2010.ExcelAc</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2010.Ink</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2010.PowerPoint</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2010.Word</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2010.Word.Drawing</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2010.Word.DrawingCanvas</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2010.Word.DrawingGroup</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2010.Word.DrawingShape</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2013.Drawing</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2013.Drawing.Chart</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2013.Drawing.ChartStyle</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2013.Drawing.TimeSlicer</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2013.Excel</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2013.ExcelAc</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2013.PowerPoint</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2013.PowerPoint.Roaming</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2013.Theme</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2013.WebExtension</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2013.WebExtentionPane</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2013.Word</Namespace>
  <Namespace>DocumentFormat.OpenXml.Office2013.Word.Drawing</Namespace>
  <Namespace>DocumentFormat.OpenXml.Packaging</Namespace>
  <Namespace>DocumentFormat.OpenXml.Presentation</Namespace>
  <Namespace>DocumentFormat.OpenXml.Spreadsheet</Namespace>
  <Namespace>DocumentFormat.OpenXml.Validation</Namespace>
  <Namespace>DocumentFormat.OpenXml.VariantTypes</Namespace>
  <Namespace>DocumentFormat.OpenXml.Vml</Namespace>
  <Namespace>DocumentFormat.OpenXml.Vml.Office</Namespace>
  <Namespace>DocumentFormat.OpenXml.Vml.Presentation</Namespace>
  <Namespace>DocumentFormat.OpenXml.Vml.Spreadsheet</Namespace>
  <Namespace>DocumentFormat.OpenXml.Vml.Wordprocessing</Namespace>
  <Namespace>DocumentFormat.OpenXml.Wordprocessing</Namespace>
  <Namespace>TopSoft.ExcelExport</Namespace>
  <Namespace>TopSoft.ExcelExport.Attributes</Namespace>
  <Namespace>TopSoft.ExcelExport.Entity</Namespace>
  <Namespace>TopSoft.ExcelExport.Styles</Namespace>
</Query>

void Main()
{

var CalendarDates = TypeDefinitionLookup
	.Where(r => r.RelatedType.Equals("CAL"))
	.AsEnumerable()
	.Where(sy => int.Parse(sy.ApplSchoolYear) > 2005)
	.Select(cl => new{
		scl = cl.CodeValue.Substring(0,2),
		Year = cl.CodeValue.Substring(2,4),
		Month = cl.CodeValue.Substring(6,2),
		DateValue = new System.DateTime(int.Parse(cl.CodeValue.Substring(2,4)),int.Parse(cl.CodeValue.Substring(6,2)),1),
		//cl.CodeValue,
		cl.Description,
		DayDef = new []{
		CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),1,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(4,5)),
		CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),2,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(9,5)),
		CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),3,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(14,5)),
		CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),4,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(19,5)),
		CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),5,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(24,5)),
		CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),6,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(29,5)),
		CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),7,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(34,5)),
		CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),8,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(39,5)),
		CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),9,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(44,5)),
		 CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),10,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(49,5)),
		 CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),11,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(54,5)),
		 CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),12,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(59,5)),
		 CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),13,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(64,5)),
		 CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),14,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(69,5)),
		 CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),15,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(74,5)),
		 CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),16,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(79,5)),
		 CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),17,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(84,5)),
		 CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),18,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(89,5)),
		 CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),19,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(94,5)),
		 CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),20,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(99,5)),
		 CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),21,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(104,5)),
		 CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),22,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(109,5)),
		 CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),23,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(114,5)),
		 CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),24,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(119,5)),
		 CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),25,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(124,5)),
		 CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),26,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(129,5)),
		 CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),27,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(134,5)),
		 CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),28,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(139,5)),
		 DateTime.DaysInMonth(int.Parse(cl.CodeValue.Substring(2,4)),int.Parse(cl.CodeValue.Substring(6,2))) > 28
					? CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),29,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(144,5))
					: new CalDef(),
		DateTime.DaysInMonth(int.Parse(cl.CodeValue.Substring(2,4)),int.Parse(cl.CodeValue.Substring(6,2))) > 29
					? CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),30,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(149,5))
					: new CalDef(),
		DateTime.DaysInMonth(int.Parse(cl.CodeValue.Substring(2,4)),int.Parse(cl.CodeValue.Substring(6,2))) > 30
					? CalDef.Define(cl.CodeValue.Substring(6,2),cl.CodeValue.Substring(2,4),31,cl.CodeValue.Substring(0,2),cl.VariableContent.Substring(154,5))
					: new CalDef()
		},
		cl.VariableContent
	})
	.SelectMany(dd => dd.DayDef.TakeWhile(t => t.StudentCalendar != null));
	
	CalendarDates.Dump();
	
	
//	using (SpreadsheetDocument spreadsheetDocument = SpreadsheetDocument.Create(@"F:\BVA\MSD\MSD.Calendar.Day.Extracts.xlsx", SpreadsheetDocumentType.Workbook))
//	{
//	var xExportCtx = new ExportContext(spreadsheetDocument);
//	
//	uint rowNo = 0;
//	foreach (var CalDef in CalendarDates)
//	{
//		rowNo++;
//		xExportCtx.RenderEntity(CalDef,rowNo);
//	}
//		xExportCtx.SaveChanges();
//	}
	
	
}

// Define other methods and classes here
public class CalDef : ExcelRow
{
	[CellData("A")]
	public String CalendarDate {get;set;}
	[CellData("B")]
	public String StudentCalendar {get;set;}
	[CellData("C")]
	public String DayOfTheWeek {get;set;}
	[CellData("D")]
	public String WeekTheDayBelongsTo {get;set;}
	[CellData("E")]
	public String AttendanceDayIndicator {get;set;}
	[CellData("F")]
	public String EntryDateType {get;set;}
	[CellData("G")]
	public String WithdrawalDateType {get;set;}
	
	public static CalDef Define (string month, string year, int dayOfMonth ,string stdCal, string varCtd)
	{
		return new CalDef ()
		{
			CalendarDate = new System.DateTime(int.Parse(year),int.Parse(month),dayOfMonth).ToShortDateString(),
			StudentCalendar = stdCal,
			DayOfTheWeek = new System.DateTime(int.Parse(year),int.Parse(month),dayOfMonth).DayOfWeek.ToString(),
			WeekTheDayBelongsTo =varCtd.Substring(1,1),
			AttendanceDayIndicator = varCtd.Substring(2,1),
			EntryDateType =varCtd.Substring(3,1),
			WithdrawalDateType = varCtd.Substring(4,1)
			
			
		};
	}
	
	
}